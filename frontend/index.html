<!DOCTYPE html>
<html lang="pt-br">

<head>
    <meta charset="UTF-8">
    <title>AC - An√°lise e Complexidade de Algoritmos</title>
    <link rel="stylesheet" href="style.css">
</head>

<body>
    <h1>Execu√ß√£o de Algoritmos em Grafos üìà</h1>
    <p>Projeto da disciplina de An√°lise e Complexidade de Algoritmos (IBM3121) - 2025.1</p>

    <div class="card">
        <h2>Controles</h2>
        <form id="controles-form">
            <label for="graph-select">Escolha um Grafo:</label>
            <select id="graph-select" onchange="selecionarGrafo()"></select>

            <label for="start-node-select">N√≥ Inicial:</label>
            <select id="start-node-select"></select>

            <button type="button" onclick="executar('dfs')">Executar DFS</button>
            <button type="button" onclick="executar('bfs')">Executar BFS</button>
        </form>
    </div>
    
    <div class="card">
        <h2>Estrutura do Grafo</h2>
        <div class="estrutura-container">
            <div class="estrutura-coluna">
                <h3>Lista de Adjac√™ncia</h3>
                <pre id="grafo-adjacencia">Selecione um grafo.</pre>
            </div>
            <div class="estrutura-coluna">
                <!-- O t√≠tulo foi alterado -->
                <h3>Visualiza√ß√£o Gr√°fica</h3>
                <!-- O <pre> foi trocado por uma <div> para conter a imagem -->
                <div id="imagem-container">
                    <p>Selecione um grafo.</p>
                </div>
            </div>
        </div>
    </div>

    <div class="card">
        <h2>Resultado do Algoritmo</h2>
        <div id="resultado-container">
            <p id="resultado-placeholder">O resultado da execu√ß√£o aparecer√° aqui.</p>
        </div>
    </div>

    <script>
        let grafosDisponiveis = {};

        window.onload = function() {
            // A chamada para a API continua a mesma
            fetch('http://localhost:5000/grafos')
                .then(res => res.json())
                .then(data => {
                    grafosDisponiveis = data;
                    const graphSelect = document.getElementById('graph-select');
                    graphSelect.innerHTML = '<option value="">-- Selecione --</option>';
                    for (const id in grafosDisponiveis) {
                        const option = document.createElement('option');
                        option.value = id;
                        option.innerText = grafosDisponiveis[id].nome;
                        graphSelect.appendChild(option);
                    }
                })
                .catch(err => {
                    console.error("Erro ao buscar grafos:", err);
                    document.getElementById('resultado-placeholder').innerText = "‚ùå Falha ao conectar com a API.";
                });
        };

        function selecionarGrafo() {
            const graphId = document.getElementById('graph-select').value;
            const startNodeSelect = document.getElementById('start-node-select');
            const adjacenciaDiv = document.getElementById('grafo-adjacencia');
            // NOVO: Pega o container da imagem
            const imagemContainer = document.getElementById('imagem-container');
            
            startNodeSelect.innerHTML = '';

            if (!graphId) {
                adjacenciaDiv.innerText = "Selecione um grafo.";
                // Limpa o container da imagem
                imagemContainer.innerHTML = "<p>Selecione um grafo.</p>";
                return;
            }

            const grafo = grafosDisponiveis[graphId];

            grafo.nos.forEach(no => {
                const option = document.createElement('option');
                option.value = no;
                option.innerText = no;
                startNodeSelect.appendChild(option);
            });

            // Preenche a lista de adjac√™ncia (continua igual)
            let adjacenciaTexto = "";
            for (const no in grafo.estrutura_adj) {
                adjacenciaTexto += `${no}: [${grafo.estrutura_adj[no].join(", ")}]\n`;
            }
            adjacenciaDiv.innerText = adjacenciaTexto.trim();
            
            // --- L√ìGICA PARA EXIBIR A IMAGEM ---
            imagemContainer.innerHTML = ''; // Limpa o texto "Selecione um grafo"
            const img = document.createElement('img');
            
            // Define qual imagem carregar baseado no ID do grafo
            if (graphId === 'nao_direcionado') {
                img.src = 'imgGrafos/naoDirecionado.png';
                img.alt = 'Grafo n√£o-direcionado';
            } else if (graphId === 'direcionado') {
                img.src = 'imgGrafos/direcionado.png';
                img.alt = 'Grafo direcionado';
            }
            
            imagemContainer.appendChild(img);
        }

        function formatarResultado(data) {
            const { algoritmo, resultado, no_inicial } = data;
            const { ordem_visita, pais } = resultado;
            let html = `<h3>${algoritmo} Result</h3><p><strong>N√≥ Inicial Escolhido:</strong> ${no_inicial}</p><p><strong>Ordem de Visita:</strong> ${ordem_visita.join(" ‚Üí ")}</p><table><thead><tr><th>N√≥</th><th>Pai</th>`;
            if (algoritmo === "BFS") { html += "<th>Dist√¢ncia</th>"; }
            if (algoritmo === "DFS") { html += "<th>T. Descoberta (Pr√©-ordem)</th><th>T. Finaliza√ß√£o (P√≥s-ordem)</th>"; }
            html += "</tr></thead><tbody>";
            const nosOrdenados = Object.keys(pais).sort();
            for (const no of nosOrdenados) {
                html += `<tr><td>${no}</td><td>${pais[no] || "N/A"}</td>`;
                if (algoritmo === "BFS") { html += `<td>${resultado.distancias[no]}</td>`; }
                if (algoritmo === "DFS") { html += `<td>${resultado.tempo_descoberta[no]}</td><td>${resultado.tempo_finalizacao[no]}</td>`; }
                html += "</tr>";
            }
            html += "</tbody></table>";
            return html;
        }

        function executar(tipo) {
            const idGrafo = document.getElementById('graph-select').value;
            const inicio = document.getElementById('start-node-select').value;
            const resultadoContainer = document.getElementById('resultado-container');

            if (!idGrafo || !inicio) {
                alert("Por favor, selecione um grafo e um n√≥ inicial.");
                return;
            }

            resultadoContainer.innerHTML = "<p>Processando...</p>";
            fetch(`http://localhost:5000/${tipo}`, {
                    method: "POST",
                    headers: { "Content-Type": "application/json" },
                    body: JSON.stringify({ id_grafo: idGrafo, inicio: inicio })
                })
                .then(res => res.json())
                .then(data => {
                    if (data.erro) {
                        resultadoContainer.innerHTML = `<p class="erro">Erro: ${data.erro}</p>`;
                    } else {
                        resultadoContainer.innerHTML = formatarResultado(data);
                    }
                })
                .catch(err => {
                    console.error("Erro na execu√ß√£o:", err);
                    resultadoContainer.innerHTML = "<p class='erro'>Ocorreu um erro ao processar a sua solicita√ß√£o.</p>";
                });
        }
    </script>
</body>
</html>
